{% extends 'html/base.html' %}

{% if homelab %}
    {% block title %}
        {{ homelab.name }} - Homelab Operator
    {% endblock %}
{% endif %}

{% block headline %}
    <div class="dropdown">
        <span class="dropbtn" onclick="document.querySelector('.dropdown-content').classList.toggle('dropdown-show');">
            {% if homelab %}
                {{ homelab.name }}
            {% else %}
                Homelab Operator
            {% endif %}
            </span>
        <i class="soft fa-solid fa-chevron-down"></i>
        <div class="dropdown-content">
            {% if homelabs %}
                <div class="soft" style="font-weight: normal; margin-left: 0.5rem;">Switch homelab:</div>
                <div class="spacer" style="height: 0.25rem;"></div>
                {% for h in homelabs %}
                    <div class="dropdown-item">
                        <a href="/dashboard/{{ h.id }}">
                            <div>
                                {{ h.name }}
                                {% if h.id == homelab.id %}
                                    <i class="fa-solid fa-check" style="color: #4CAF50;"></i>
                                {% endif %}
                                <br>
                                <span class="soft">{{ h.description }}</span>
                            </div>
                            <div style="margin: auto 0 auto auto;">
                                {% with homelab_id=h.id|stringformat:'s' %}
                                    {% include 'html_components/inline_button.html' with label='' fa_icon='fa-pen-to-square' href='/edit/homelab/'|add:homelab_id %}
                                {% endwith %}
                            </div>
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                <div class="soft" style="font-weight: normal; margin-left: 0.5rem;">No Homelabs found...</div>
                <div class="spacer" style="height: 0.25rem;"></div>
            {% endif %}
            <span style="display: block; padding: 0 0.5rem 0 0.5rem; font-size: 1rem; font-weight: normal;">
                {% include 'html_components/inline_button.html' with label='Homelab' fa_icon='fa-plus' href='/create/homelab/' %}
            </span>
        </div>
    </div>
{% endblock %}

{% block content %}
    {% if not homelabs %}
        <div>
            <h2>Welcome to Homelab Operator!</h2>
            <p>
                It seems you haven't set up any homelabs yet. Please create a homelab to get started.<br>
                You can create a homelab by clicking the button below:
            </p>
            <span style="display: flex; width: 10rem;">
                {% include 'html_components/inline_button.html' with label='Create Homelab' fa_icon='fa-plus' href='/create/homelab/' %}
            </span>
        </div>
    {% else %}

        {# Cron Status Indicator #}
        {% if cron_status %}
            <div class="tile" style="margin-bottom: 1rem;">
                <div style="display: flex; align-items: center;">
                    <div>
                        <h3 style="margin: 0; display: flex; align-items: center;">
                            {% if cron_status.is_cron_healthy %}
                                <i class="fas fa-clock" style="color: #4CAF50; margin-right: 0.5rem;"></i>
                                Cron Service
                            {% else %}
                                <i class="fas fa-clock" style="color: #f44336; margin-right: 0.5rem;"></i>
                                Cron Service
                            {% endif %}
                        </h3>
                    </div>
                    <div style="margin-left: auto;">
                        {% if cron_status.is_cron_healthy %}
                            <span style="color: #4CAF50; font-weight: bold;">Healthy</span>
                        {% else %}
                            <span style="color: #f44336; font-weight: bold;">Unhealthy</span>
                        {% endif %}
                    </div>
                </div>
                <div class="spacer" style="height: 0.5rem;"></div>
                <div style="border-top: 1px solid #ccc;"></div>
                <div class="spacer" style="height: 0.5rem;"></div>
                <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                    <div>
                        <span class="soft">Last execution:</span>
                        {% if cron_status.last_execution %}
                            {{ cron_status.last_execution|date:"Y-m-d H:i:s" }}
                        {% else %}
                            Never
                        {% endif %}
                    </div>
                    <div>
                        <span class="soft">Total runs:</span> {{ cron_status.execution_count }}
                    </div>
                </div>
                {% if cron_status.last_error %}
                    <div class="spacer" style="height: 0.5rem;"></div>
                    <div style="color: #f44336; font-size: 0.9rem;">
                        <span class="soft">Last error:</span> {{ cron_status.last_error|truncatechars:100 }}
                    </div>
                {% endif %}
            </div>
        {% endif %}

        {# Wiki #}
        {% if user_show_wiki %}
            {% include 'html/dashboard-sections/wiki.html' with servers=servers wiki=wiki %}
        {% endif %}

        {# Networks #}
        {% if user_show_networks %}
            {% include 'html/dashboard-sections/networks.html' with networks=networks %}
        {% endif %}

        {# Servers #}
        {% include 'html/dashboard-sections/servers.html' with servers=servers %}

    {% endif %}
{% endblock %}
